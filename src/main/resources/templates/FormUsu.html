<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Formulario</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

        <meta name="theme-color" content="#712cf9">
    </head>
    <body class="bg-light">

        <div class="container my-5">
            <form method="post" th:object="${Usuario}" th:action="@{add}" class="p-4 border rounded shadow bg-white" enctype="multipart/form-data">
                <input type="hidden" th:field="*{idUsuario}" />

                <h1 class="mb-4 text-center">Formulario de Usuario</h1> 

                <!-- Datos Personales -->
                <section class="mb-4">
                    <h4 class="mb-3">Nombre</h4>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="NombreAlumno" class="form-label">Nombre(s)</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person-circle"></i></span>
                                <input type="text" class="form-control" id="NombreAlumno" th:field="*{Nombre}" placeholder="Nombre(s)" onkeypress="SoloLetras(event, this)">
                                <span class="text-danger error-msg"></span>
                            </div>
                            <div class="text-danger" th:if="${#fields.hasErrors('Nombre')}" th:errors="*{Nombre}"></div>                         
                        </div>

                        <div class="col-md-4">
                            <label for="ApellidoPaterno" class="form-label">Apellido Paterno</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person-circle"></i></span>
                                <input type="text" class="form-control" id="ApellidoPaterno" th:field="*{ApellidoPaterno}" placeholder="Apellido Paterno" onkeypress="SoloLetras(event, this)">
                                <span class="text-danger error-msg"></span>
                            </div>
                            <div class="text-danger" th:if="${#fields.hasErrors('ApellidoPaterno')}" th:errors="*{ApellidoPaterno}"></div>
                        </div>
                        <div class="col-md-4">
                            <label for="ApellidoMaterno" class="form-label">Apellido Materno</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person-circle"></i></span>
                                <input type="text" class="form-control" id="ApellidoMaterno" th:field="*{ApellidoMaterno}" placeholder="Apellido Materno" onkeypress="SoloLetras(event, this)">
                                <span class="text-danger error-msg"></span>
                            </div>
                            <div class="text-danger" th:if="${#fields.hasErrors('ApellidoMaterno')}" th:errors="*{ApellidoMaterno}"></div>
                        </div>
                        <div class="card p-3 w-100 h-100">
                            <label for="imagenFile" class="form-label fw-bold">Imagen</label>
                            <input type="file" class="form-control mb-2" name="imagenFile" accept="image/png, image/jpeg, image/jpg" id="Imagen">
                            <!--<img id="Imagen" style="max-width: 300px; max-height: auto" class="mx-auto" src="https://static-00.iconduck.com/assets.00/profile-default-icon-2048x2045-u3j7s5nj.png"/>-->
                            <!--                                <img th:src="${persona.imagen != null ? persona.imagen : 'https://static-00.iconduck.com/assets.00/profile-default-icon-2048x2045-u3j7s5nj.png'}"
                                                                 style="max-width:300px"
                                                                 class="mx-auto"/>-->
                        </div>
                    </div>
                </section>

                <!-- Contacto -->
                <section class="mb-4">
                    <h4 class="mb-3">Datos de contacto</h4>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="Telefono" class="form-label">Teléfono</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-telephone-fill"></i></span>
                                <input type="text" class="form-control" id="Telefono" th:field="*{Telefono}" placeholder="Teléfono">
                                <div class="text-danger" th:if="${#fields.hasErrors('Telefono')}" th:errors="*{Telefono}"></div>
                            </div>                           
                        </div>
                        <div class="col-md-4">
                            <label for="Celular" class="form-label">Celular</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-phone"></i></span>
                                <input type="text" class="form-control" id="Celular" th:field="*{Celular}" placeholder="Celular">
                                <div class="text-danger" th:if="${#fields.hasErrors('Celular')}" th:errors="*{Celular}"></div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="Email" class="form-label">Email</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-envelope-at"></i></span>
                                <input type="email" class="form-control" id="Email" th:field="*{Email}" placeholder="Email">
                                <div class="text-danger" th:if="${#fields.hasErrors('Email')}" th:errors="*{Email}"></div>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- Información adicional -->
                <section class="mb-4">
                    <h4 class="mb-3">Información</h4>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="Curp" class="form-label">CURP</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person-bounding-box"></i></span>
                                <input type="text" class="form-control" id="Curp" th:field="*{Curp}" placeholder="Curp">
                                <div class="text-danger" th:if="${#fields.hasErrors('Curp')}" th:errors="*{Curp}"></div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="Username" class="form-label">Usuario</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person"></i></span>
                                <input type="text" class="form-control" id="Username" th:field="*{Username}" placeholder="Usuario">
                                <div class="text-danger" th:if="${#fields.hasErrors('Username')}" th:errors="*{Username}"></div>
                            </div>
                        </div>
                        <div class="col-md-4">                         
                            <label for="password" class="form-label">Contraseña</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-person-lock"></i></span>
                                <input type="password" class="form-control" id="password" th:field="*{password}" placeholder="Contraseña">
                                <div class="text-danger" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
                            </div>

                        </div>
                </section>

                <!-- Fecha de nacimiento y sexo -->
                <section class="mb-4">
                    <div class="row g-3 align-items-center">
                        <div class="col-md-6">
                            <label for="fechanacimiento" class="form-label">Fecha de nacimiento</label>
                            <input type="date" class="form-control" id="fechanacimiento" th:field="*{fechanacimiento}">
                            <div class="text-danger" th:if="${#fields.hasErrors('fechanacimiento')}" th:errors="*{fechanacimiento}"></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label d-block">Sexo</label>
                            <div class="btn-group" role="group">
                                <input type="radio" class="btn-check" name="sexo" id="sexoH" autocomplete="off" th:field="*{Sexo}" value="H">
                                <label class="btn btn-outline-primary" for="sexoH"><i class="bi bi-person"></i> Hombre</label>

                                <input type="radio" class="btn-check" name="sexo" id="sexoM" autocomplete="off" th:field="*{Sexo}" value="M">
                                <label class="btn btn-outline-primary" for="sexoM"><i class="bi bi-person-dress"></i> Mujer</label>
                                <div class="text-danger" th:if="${#fields.hasErrors('Sexo')}" th:errors="*{Sexo}"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Rol -->
                <section class="mb-4">
                    <label for="RolUsuario" class="form-label">Rol</label>
                    <select class="form-select" id="RolUsuario" th:field="*{rol.idRol}">
                        <option value="0">Selecciona un Rol</option>
                        <option th:each="rol : ${Roles}" th:text="${rol.Nombre}" th:value="${rol.idRol}"></option>
                    </select>
                </section>

                <!-- Dirección -->
                <section class="mb-4">
                    <h4 class="mb-3">Dirección</h4>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="Calle" class="form-label">Calle</label>
                            <input type="text" class="form-control" th:field="*{Direcciones[0].Calle}" placeholder="Calle">                            
                        </div>
                        <div class="col-md-3">
                            <label for="NumeroExterior" class="form-label">Número Exterior</label>
                            <input type="text" class="form-control"  th:field="*{Direcciones[0].NumeroExterior}" placeholder="Número Exterior">
                        </div>
                        <div class="col-md-3">
                            <label for="NumeroInterior" class="form-label">Número Interior</label>
                            <input type="text" class="form-control"  th:field="*{Direcciones[0].NumeroInterior}" placeholder="Número Interior">
                        </div>
                    </div>

                    <div class="row g-3 mt-3">
                        <div class="col-md-3">
                            <label for="ddlpais" class="form-label">País</label>
                            <select id="ddlpais" class="form-select">
                                <option value="0" selected>Selecciona un país</option>
                                <option th:each="pais : ${Paises}" th:text="${pais.Nombre}" th:value="${pais.idPais}"></option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="ddlestado" class="form-label">Estado</label>
                            <select id="ddlestado" th:field="*{Direcciones[0].Colonia.municipio.estado.idEstado}" class="form-select">
                                <option value="0" selected>Selecciona un estado</option>
                            </select>
                        </div>

                        <div class="col-md-3">
                            <label for="ddlmunicipio" class="form-label">Municipio</label>
                            <select id="ddlmunicipio" th:field="*{Direcciones[0].Colonia.municipio.idMunicipio}" class="form-select">
                                <option value="0" selected>Selecciona un municipio</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="ddlcolonia" class="form-label">Colonia</label>                            
                            <select id="ddlcolonia" class="form-select" th:field="*{Direcciones[0].Colonia.idColonia}">
                                <option value="0" selected>Selecciona una colonia</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- Botón submit -->

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">Guardar</button>
                </div>

            </form>
        </div>

        <!-- jQuery y Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

        <script>

                                    $(document).ready(function () {

                                        $("#ddlpais").change(function () {
                                            if ($("#ddlpais").val() == 0) {
                                                $("#ddlestado").empty();
                                                $("#ddlestado").append("<option value=0 selected>Selecciona un estado</option>");
                                            } else {

                                                $.ajax({
                                                    url: "/api/estado/getEstadosByPais/" + $("#ddlpais").val(),
                                                    method: 'GET',
                                                    dataType: 'json',
                                                    success: function (data, textStatus, jqXHR) {
                                                        if (data.Correct) {
                                                            $("#ddlestado").empty();
                                                            $("#ddlestado").append("<option value=0 selected>Selecciona un estado</option>");
                                                            $.each(data.Objects, function (i, estado) {
                                                                $("#ddlestado").append(
                                                                        "<option value=" + estado.idEstado + ">" + estado.nombre + "</option>"
                                                                        );
                                                            });

                                                        }
                                                    },
                                                    error: function (jqXHR, textStatus, errorThrown) {
                                                        alert("Algo salio mal");
                                                    }

                                                });
                                            }
                                        });


                                        $("#ddlestado").change(function () {
                                            if ($("#ddlestado").val() == 0) {
                                                $("#ddlmunicipio").empty();
                                                $("#ddlmunicipio").append("<option value=0 selected>Selecciona un municipio</option>");
                                            } else {
                                                $.ajax({
                                                    url: "/api/municipio/getMunicipioByEstado/" + $("#ddlestado").val(),
                                                    method: 'GET',
                                                    dataType: 'json',
                                                    success: function (data, textStatus, jqXHR) {
                                                        if (data.Correct) {
                                                            $("#ddlmunicipio").empty();
                                                            $("#ddlmunicipio").append("<option value=0 selected>Selecciona un municipio</option>");
                                                            $.each(data.Objects, function (i, municipio) {
                                                                $("#ddlmunicipio").append(
                                                                        '<option value="' + municipio.idMunicipio + '">' + municipio.nombre + '</option>'
                                                                        );
                                                            });
                                                        }
                                                    },
                                                    error: function (jqXHR, textStatus, errorThrown) {
                                                        alert("Algo salio mal");
                                                    }

                                                });
                                            }

                                        });


                                        $("#ddlmunicipio").change(function () {
                                            if ($("#ddlmunicipio").val() == 0) {
                                                $("#ddlcolonia").empty();
                                                $("#ddlcolonia").append("<option value=0 selected>Selecciona una colonia</option>");
                                            } else {
                                                $.ajax({
                                                    url: "/api/colonia/getColoniaByMunicipio/" + $("#ddlmunicipio").val(),
                                                    method: 'GET',
                                                    dataType: 'json',
                                                    success: function (data, textStatus, jqXHR) {
                                                        if (data.Correct) {

                                                            $("#ddlcolonia").empty();
                                                            $("#ddlcolonia").append("<option value=0 selected>Selecciona una colonia</option>");
                                                            $.each(data.Objects, function (i, colonia) {
                                                                $("#ddlcolonia").append(
                                                                        '<option value="' + colonia.idColonia + '">' + colonia.nombre + '</option>');
                                                            });
                                                        }
                                                    },
                                                    error: function (jqXHR, textStatus, errorThrown) {
                                                        alert("Algo salio mal");
                                                    }

                                                });
                                            }

                                        });

                                    });

        </script>

        <script>

            function numeroCT(event, input) {
                let key = event.key;
                let RegExp = /^\d{10}$/;
                if (RegExp.test(input.value)) {
                    $(input).removeClass("error").addClass("correct");
                    $(input).siblings(".error-msg").text("");
                } else {
                    $(input).removeClass("correct").addClass("error");
                    $(input).siblings(".error-msg").text("Ingresa un número válido");
                }
            }

            function Curp(event, input) {
                let value = input.value;
                let RegExp = /^[A-Z]{4}[0-9]{6}[A-Z]{7}[0-9]{1}$/;
                if (RegExp.test(value)) {
                    $(input).removeClass("error").addClass("correct");
                    $(input).siblings(".error-msg").text("");
                } else {
                    $(input).removeClass("correct").addClass("error");
                    $(input).siblings(".error-msg").text("Ingresa una curp valida");
                }
            }

            function SoloLetras(event, input) {
                let key = event.key;
                let RegExp = /[a-zA-Z]+/;
                if (RegExp.test(key)) {
                    $(input).removeClass("error").addClass("correct");
                    $(input).siblings(".error-msg").text("");
                } else {
                    $(input).removeClass("correct").addClass("error");
                    $(input).siblings(".error-msg").text("Solo se permiten letras");
                    event.preventDefault();
                }
            }

            function Email(event, input) {
                let key = event.key;
                let RegExp = /^[^@]+@[^@]+\.[a-zA-Z]{2,}$/;
                if (RegExp.test(input.value)) {
                    $(input).removeClass("error").addClass("correct");
                    $(input).siblings(".error-msg").text("");
                } else {
                    $(input).removeClass("correct").addClass("error");
                    $(input).siblings(".error-msg").text("Ingresa un correo valido");
                    event.preventDefault();
                }
            }

            function ValidarFecha(event, input) {
                const valor = input.value;
                const $input = $(input);
                const $errorMsg = $input.siblings(".error-msg");

                if (!valor) {
                    $input.removeClass("correct error");
                    $errorMsg.text("");
                    return;
                }


                const fechaSeleccionada = new Date(valor);

                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);


                if (fechaSeleccionada <= hoy) {
                    $input.removeClass("error").addClass("correct");
                    $errorMsg.text("");
                } else {
                    $input.removeClass("correct").addClass("error");
                    $errorMsg.text("Ingrese una fecha correcta");
                }
            }

            function username(event, input) {
                let key = event.key();
                let RegExp = /\w+/;
                if (RegExp.test(key)) {
                    $(input).removeClass("error").addClass("correct");
                } else {
                    $(input).removeClass("correct").addClass("error");
                    $(input).siblings(".error-msg").text("Ingresa un usuario valido");
                    event.preventDefault();
                }

            }

            function password(event, input) {

                let RegExp = /^(?=\w*\d)(?=\w*[A-Z])(?=\w*[a-z])\S{8,}$/;
                if (RegExp.test(input.value)) {

                    $(input).removeClass("error").addClass("correct");
                    $(input).siblings(".error-msg").text(""); // Limpiar el mensaje de error
                } else {

                    $(input).removeClass("correct").addClass("error");
                    $(input).siblings(".error-msg").text("Ingresa una contraseña de mínimo 8 dígitos con al menos una mayúscula y número.");
                }
            }

        </script>


    </body>
</html>
